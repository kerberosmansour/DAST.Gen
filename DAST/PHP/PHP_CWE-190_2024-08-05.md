# Integer Overflow or Wraparound (CWE-190) in PHP

****Understanding Integer Overflow or Wraparound**

**Integer Overflow or Wraparound** occurs when an arithmetic operation results in a value that is outside the representable range of the data type. For instance, in a system where integers are represented using 32 bits, trying to store the number 2³² (which equals 4,294,967,296) in a 32-bit integer will cause the value to wrap around and be stored as 0. This can lead to vulnerabilities because a wrapped value can cause unexpected behavior in a program, such as incorrect calculations, buffer overflows, or security checks being bypassed.

### Variations in PHP Web Applications

Integer overflow or wraparound can occur in several ways in a PHP web application, especially when interacting with user inputs, databases, or performing arithmetic operations. Here are some common scenarios:

1. **User Input Validation**: Failing to properly validate user inputs when they are expected to be within certain numerical ranges.
2. **File Uploads**: Calculating or checking file sizes can result in overflow if done incorrectly.
3. **Loop Counters and Array Indexes**: Using user inputs directly in loop counts or as array indexes without proper boundary checking.
4. **Database Operations**: When storing and retrieving large numerical values from the database, improper handling can lead to overflow issues.
5. **Time and Date Calculations**: Arithmetic operations on timestamps, durations, or dates without proper bounds checking.

### Example Detection Scripts Using OWASP ZAP Zest

#### 1. User Input Validation

**Scenario**: Validation of user-provided age.

**Zest Script**:
```json
{
  "type": "zest",
  "version": "0.4",
  "actions": [
    {
      "elementType": "ZestRequest",
      "url": "http://example.com/register",
      "method": "POST",
      "data": "age=2147483648",
      "headers": "Content-Type: application/x-www-form-urlencoded",
      "index": 0
    },
    {
      "elementType": "ZestAssertion",
      "rootExpression": {
        "elementType": "ZestExpressionStatusCode",
        "code": 500,
        "not": true
      },
      "index": 1
    },
    {
      "elementType": "ZestActionFail",
      "message": "Potential overflow in age validation",
      "index": 2
    }
  ]
}
```
#### 2. File Uploads

**Scenario**: Uploading a file with size that, when added to some boundary variable, exceeds the integer storage capacity.

**Zest Script**:
```json
{
  "type": "zest",
  "version": "0.4",
  "actions": [
    {
      "elementType": "ZestRequest",
      "url": "http://example.com/upload",
      "method": "POST",
      "data": "file=@largefile.txt",
      "headers": "Content-Type: multipart/form-data",
      "index": 0
    },
    {
      "elementType": "ZestAssertion",
      "rootExpression": {
        "elementType": "ZestExpressionRegex",
        "regex": ".*integer overflow.*",
        "location": "BODY"
      },
      "index": 1
    },
    {
      "elementType": "ZestActionFail",
      "message": "Potential integer overflow in file upload",
      "index": 2
    }
  ]
}
```
#### 3. Loop Counters and Array Indexes

**Scenario**: Using a large number in a loop counter.

**Zest Script**:
```json
{
  "type": "zest",
  "version": "0.4",
  "actions": [
    {
      "elementType": "ZestRequest",
      "url": "http://example.com/process",
      "method": "GET",
      "parameters": "loopCount=2147483648",
      "index": 0
    },
    {
      "elementType": "ZestAssertion",
      "rootExpression": {
        "elementType": "ZestExpressionStatusCode",
        "code": 500,
        "not": true
      },
      "index": 1
    },
    {
      "elementType": "ZestActionFail",
      "message": "Potential integer overflow in loop counter usage",
      "index": 2
    }
  ]
}
```

### Minimizing False Positives and False Negatives

**False Positives**:
- Tune the regex patterns to be more specific to the context.
- Add additional validations to confirm overflow scenarios before failing actions.

**False Negatives**:
- Ensure that the range of test cases includes boundary conditions and edge cases.
- Use multiple assertions to capture different layers of the application response.

Accurate detection and proper handling of Integer Overflows or Wraparounds are crucial in developing robust and secure applications. By creating comprehensive Zest scripts for OWASP ZAP, we can automate and improve the detection of these vulnerabilities during web application testing.