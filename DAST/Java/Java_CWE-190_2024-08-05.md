# Integer Overflow or Wraparound (CWE-190) in Java

###### Understanding Integer Overflow or Wraparound

**Definition:**
An Integer Overflow or Wraparound occurs when an arithmetic operation attempts to create a numeric value that is outside the range that can be represented with a given number of bits. Since the value can't be represented, it wraps around from the maximum possible value to the minimum possible value or vice versa.

**Example in Java:**
```java
int maxInt = Integer.MAX_VALUE;
int result = maxInt + 1; // This results in overflow, wrapping around to Integer.MIN_VALUE
```

**Context in Web Applications:**
In a web application, an Integer Overflow can happen in various areas, including data validation, user input processing, and arithmetic operations. Unchecked integer operations can lead to vulnerabilities such as buffer overflow, logic errors, and eventually give attackers an opportunity to execute arbitrary commands.

### Variations of Integer Overflow/Wraparound in Java Web Applications

1. **Basic Arithmetic Operations:**
   Any direct arithmetic operation that adds, subtracts, multiplies, or divides integers without checks can potentially overflow.

2. **User Input Validation:**
   Unchecked user inputs that are used in arithmetic operations or passed to functions relying on integer parameters can overflow.

3. **Framework Dependent Issues:**
   Different Java frameworks may have their peculiarities:
   - **Spring MVC:** When binding request parameters to integer properties without validation.
   - **Hibernate:** Database operations that involve integer fields.
   - **Apache Struts:** Form data handling that maps to integer properties without explicit validation.

### Creating OWASP ZAP Zest Scripts

**Objective:**
To create detection rules with OWASP ZAP Zest scripts that minimize false negatives and false positives. Here's how you can develop detection scripts for each variation of Integer Overflow/Wraparound:

#### 1. Basic Arithmetic Operations

**Zest Script: Detect Arithmetic Overflow**
```json
{
  "type": "ZestScript",
  "meta": {
    "title": "Detect Arithmetic Overflow",
    "author": "Security Engineer",
    "description": "Detects integer overflow in arithmetic operations."
  },
  "statements": [
    {
      "type": "ZestConditionalExpression",
      "operator": "OR",
      "expressions": [
        {
          "type": "ZestExpressionLength",
          "variableName": "response.body",
          "operator": "GREATER_THAN",
          "length": 2147483647
        },
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.body",
          "regex": "(Integer\\.MAX_VALUE|Integer\\.MIN_VALUE)"
        }
      ]
    }
  ]
}
```

#### 2. User Input Validation

**Zest Script: Detect Input Field Boundaries**
```json
{
  "type": "ZestScript",
  "meta": {
    "title": "Detect Input Field Boundary Issues",
    "author": "Security Engineer",
    "description": "Identifies user inputs leading to integer overflow."
  },
  "statements": [
    {
      "type": "ZestRequestSetParameter",
      "parameterName": "userInput",
      "parameterValue": "2147483647"
    },
    {
      "type": "ZestRequestSend",
      "index": 0
    },
    {
      "type": "ZestConditionalExpression",
      "operator": "OR",
      "expressions": [
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.body",
          "regex": "(Integer\\.MAX_VALUE|Integer\\.MIN_VALUE)"
        },
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.header.*",
          "regex": "(error|failure)"
        }
      ]
    }
  ]
}
```

#### 3. Spring MVC

**Zest Script: Detect Binding Issues in Spring MVC**
```json
{
  "type": "ZestScript",
  "meta": {
    "title": "Detect Binding Issues in Spring MVC",
    "author": "Security Engineer",
    "description": "Detects integer overflow vulnerabilities in binding request parameters to integer properties."
  },
  "statements": [
    {
      "type": "ZestRequestSetParameter",
      "parameterName": "age",
      "parameterValue": "2147483647"
    },
    {
      "type": "ZestRequestSend",
      "index": 0
    },
    {
      "type": "ZestConditionalExpression",
      "operator": "OR",
      "expressions": [
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.body",
          "regex": "(age.*overflow|Integer\\.MIN_VALUE)"
        },
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.header.*",
          "regex": "(error|failure)"
        }
      ]
    }
  ]
}
```

#### 4. Hibernate Database Operations

**Zest Script: Detect Hibernate Overflow Issues**
```json
{
  "type": "ZestScript",
  "meta": {
    "title": "Detect Hibernate Overflow Issues",
    "author": "Security Engineer",
    "description": "Detects integer overflow issues in Hibernate database operations."
  },
  "statements": [
    {
      "type": "ZestRequestSetParameter",
      "parameterName": "salary",
      "parameterValue": "2147483647"
    },
    {
      "type": "ZestRequestSend",
      "index": 0
    },
    {
      "type": "ZestConditionalExpression",
      "operator": "OR",
      "expressions": [
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.body",
          "regex": "(Integer\\.MAX_VALUE|Integer\\.MIN_VALUE)"
        },
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.header.*",
          "regex": "(error|failure)"
        }
      ]
    }
  ]
}
```

#### 5. Apache Struts Form Data Handling

**Zest Script: Detect Struts Form Handling Issues**
```json
{
  "type": "ZestScript",
  "meta": {
    "title": "Detect Struts Form Handling Issues",
    "author": "Security Engineer",
    "description": "Detects integer overflow in Apache Struts form data handling."
  },
  "statements": [
    {
      "type": "ZestRequestSetParameter",
      "parameterName": "userId",
      "parameterValue": "2147483647"
    },
    {
      "type": "ZestRequestSend",
      "index": 0
    },
    {
      "type": "ZestConditionalExpression",
      "operator": "OR",
      "expressions": [
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.body",
          "regex": "(Integer\\.MAX_VALUE|Integer\\.MIN_VALUE)"
        },
        {
          "type": "ZestExpressionRegex",
          "variableName": "response.header.*",
          "regex": "(error|failure)"
        }
      ]
    }
  ]
}
```

### Conclusion

These scripts should help in automating the detection of integer overflow vulnerabilities in various situations in web applications, significantly reducing false positives and false negatives by focusing on practical use cases and application-specific nuances. Always update and customize scripts as per your application's behavior and the frameworks in use.

Remember that while these Zest scripts provide a good starting point for detecting integer overflow vulnerabilities, continuously updating the scripts to cover new patterns and emerging threats is essential for maintaining robust application security testing.